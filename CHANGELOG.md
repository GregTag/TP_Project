# Changelog

## Checkpoint 1

### Iteration 0
* [Составлены](DESCRIPTION.md) описание, логическая модель и диаграмма классов проекта.
* Реализована логическая модель, представленная на [диаграмме](ClassDiagram.svg). 
* Реализованы методы, не зависящие от конкретных реализаций.
* Написана сборка проекта с помощью cmake.

### Iteration 1
**[[Файл с архитектурой](ClassDiagram.svg)] | [[Описание проекта](DESCRIPTION.md)]**
* Изменена вся структура файлов, в том числе изменено расширение файлов `.h` на `.hpp`.
* Изменена сборка проекта под структуру файлов.
* `struct Account` заменён на `class Account`.
* Изменена структура каждого класса.
* Убраны не нужные scope'ы в `permissions.cpp`.
* Убрано статическое поле в классе `Account`.
* Добавлен фасад `AccountDatabase` без имплементации. Здесь применён паттерн синглетон.
* Приведена к общему стилю передача объектов в параметрах методов (от константных ссылок к `std::shared_ptr`)
* Переименовано поле `wrapper` в декораторах сообщений.
* `uint32_t` --> `size_t`.
* Создан фасад `MessagesFacade`, чтобы упростить использование декораторов.
* Создан `RequestCreators`, который является обёрткой над `MessageFacade`, для создания наиболее часто используемых сообщений.
* Диаграмма классов соответствует изменениям.

## Checkpoint 2

### Iteration 0
* Реализован механизм логов: интерфейс `Logger`, реализующий паттерн синглетон. Его реализации это `DebugLogger` для клиента и `ServerLogger` для сервера. `DebugLogger` используется чтобы писать дебажную информацию в файл `log_client.txt`. В свою очередь `ServerLogger` пишет информацию и в консоль и в файл `log_server.txt`.
* Реализован класс `Socket`, который обеспечивает работу всю работу с `boost::asio::ip::tcp::socket`.
* Реализован механизм подключения клиента к серверу: создание соединения, добавление в список пользователей.
* Реализовано асинхронное прослушивание новых сообщений и дальнейшая их обработка.
* Отделена логика отрисовки сообщений от их обработки, благодаря применению структурного паттерна "Мост": теперь отрисовкой сообщений осуществляется через интерфейс `MessageRenderer`, обращение к которому происходит через `ClientsideHandler`.
* Полностью реализован консольный интерфейс для клиента `ConsoleRenderer` (реализует `MessageRenderer`), с помощью которого будут выводиться сообщения.
* Реализован парсер запросов `RequestParser`.
* Доработана логика двойной диспетчеризации сообщений и обработчиков (паттерн посетитель).
* Реализованы серверные и клиентские `main`'ы. На данном этапе проект можно:
    1) Запустить сервер `./Server 1234 ./`
    2) Подключиться к нему `./Client 127.0.0.1 1234`
    3) Увидеть приветственное сообщение от сервера `[hh:mm] Welcome!`, а на сервере увидеть `[INFO] New connection`
* Changelog был вынесен из README.
* [Описание](DESCRIPTION.md) дополнено, добавлена информация про паттерны.
* [Диаграмма](ClassDiagram.svg) классов соответствует изменениям.

### Iteration 1
* Добавлено описание запуска в [README](README.md).
* `ConsoleRenderer` теперь вызывает std::endl в конце сообщения.
* Обработка команд от пользователя в клиентской части вынесена в отдельный класс `ConsoleHandler`.
* Исправлена ошибка с командой join. Теперь можно отправить серверу команду `join <room>`, чтобы убедиться, что сервер тоже может обрабатывать сообщения от клиента.

## Checkpoint 3

### Iteration 0
* Реализация добита и проект преобразован в полностью рабочий.
* Классы `Room` и `AccountDatabase` переехали из general в serverside. 
* Реализован класс `SimpleDatabase` для хранения и записи аккаунтов. Для простоты реализации записывает все данные в файл и не хеширует пароли. Может быть заменён на настоящий фасад какой-нибудь базы данных.
* Для операций с путя теперь используется модуль `<filesystem>`, вместо простых строк.
* Реализована цепочка авторизации: ввод команды на клиенте -> отправка запроса -> получение записи из БД -> авторизация на сервере -> отправка ответа клиенту.
* Аналогично реализованы цепочки для входа и выхода из комнат, отправка сообщений и приватных сообщений.
* Работают разрешения на использование каждой команды. Пользователь без необходимого разрешения не может воспользоваться командой. Причём разрешения носят несколько уровней, более новый уровень переопределяет предыдущий. Уровни:
    1) все пользователи во всех комнатах
    2) все пользователи в какой-то комнате
    3) какой-то пользователь в какой-то комнате
* Добавлен обработчик команд на сервере, благодаря этому можно изменить аккаунт или разрешения пользователя через консоль сервера.
* Добавлены команды клиента для запроса списка пользователей и истории сообщений комнаты.
* Теперь сокеты работают без гонки потоков. Благодаря `strands` сокеты обрабатываются последовательно.
* Добавлена фича: команда manage для клиента для управления разрешениями. Описание добавлении фичи представлено [здесь](feature.md).
* Добавлена кросс компиляция под windows с использованием msys2.
* Добавлена команда help для клиента и сервера и описание в [README](README.md) как использовать приложения.
* Всё выше перечисленное не далось бы так легко, если бы большая часть работы не была бы сделана во время предыдущих двух чекпоинтов :)
* Дополнено [описание](DESCRIPTION.md), а также [диаграмма](ClassDiagram.svg) классов соответствует изменениям.
* [Добавлен](doxygen/index.html) для удобства интерактивный UML с помощью doxygen на всякий случай.
